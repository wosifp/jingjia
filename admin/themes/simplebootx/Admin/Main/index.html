<admintpl file="header" />
<style>
.home_info li em {
    float: left;
    width: 120px;
    font-style: normal;
}

li {
    list-style: none;
}
</style>
<link href="__PUBLIC__/admin/css/bootstrap.min.css" rel="stylesheet">
<link href="__PUBLIC__/admin/css/style.css" rel="stylesheet" type="text/css" />
<script src="__PUBLIC__/admin/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/js/jquery.min.js"></script>
<script src="__PUBLIC__/admin/js/style.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/datePicker/laydate/laydate.js"></script>
<!--<link type="text/css" rel="stylesheet" href="__PUBLIC__/admin/css/laydate.css">
<link type="text/css" rel="stylesheet" href="__PUBLIC__/admin/css/laydate(1).css" id="LayDateSkin"> -->
<script src="__PUBLIC__/js/echarts/echarts.min.js"></script>
<script src="__PUBLIC__/js/echarts/china.js"></script>
</head>

<body>
    <div class="qi_right_1">
        <div class="qi_con_1">
            <div class="qi_float_l qi_bfb_30">
                <p class="qi_p_2">
                    账户：<a class="btn btn-default" href="javascript:" role="button">选择 <span class="caret"></span></a>
                </p>
                <div id="firstpane" class="menu_list" style="display:none">
                    <hr>
                    <p class="qi_p_3">
                        <span>可获取对象</span>
                        <input type="text">
                        <a href="javascript:" class="qi_a_1">搜索</a>
                        <!--<input id="r2" type="radio" value="1" name="">精确 </input>-->
                    </p>
                    <foreach name="trade" item="vo" key="k">
                        <h3 class="menu_head">{$k}</h3>
                        <div style="display: none;" class="menu_body">
                            <foreach name="vo" item="companyname" key="kk">
                                <a href="javascript:">{$kk}</a>
                                <div style="display: none;" class="menu_body">
                                    <foreach name="companyname" item="user_login" key="kkk">
                                        <a href="javascript:"><span class="bai_name">{$user_login.user_login}</span></a>
                                    </foreach>
                                </div>
                            </foreach>
                        </div>
                    </foreach>
                </div>
            </div>
            <!--设备-->
            <div class="qi_float_l qi_bfb_30">
                设备：
                <select id="device">
                    <option value="0">全部</option>
                    <option value="1">PC</option>
                    <option value="2">移动</option>
                </select>
            </div>
            <div hidden="true">
                <p id="device_current">{$device_current}</p>
            </div>
            <!--设备 end-->
            <!--时间-->
            <div class="qi_float_l qi_bfb_30">
                时间：
                <input type="text" name="date_pick" id="datepicker1">
                <script>
                laydate.render({
                    elem: '#datepicker1',
                    range: true, //指定元素
                    done: function(value) {
                        window.location.href="__CONTROLLER__/index?datepicker="+value;
                        /*$.ajax({
                            type: "post",
                            url: "__CONTROLLER__/index",
                            data: {
                                datepicker: value
                            },
                            dataType: "json",
                            success: function(data) {
                               window.location.reload();
                                alert(1111111);
                            }
                        });*/
                    }
                });
                </script>
            </div>
            <!--时间 end-->
            <div class="qi_float_l qi_bfb_30" id="zhanghu" style="color: red">
            </div>
        </div>
        <div class="qi_con_1">
            <p class="qi_p_4">关键指标</p>
            <div class="jzl-module-body">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row">
                            <div class="col-lg-2 col-md-4 col-sm-6 col-sx-12" ng-repeat="(index,item) in table_items">
                                <div class="summary_target summary_target_1 summary_target_bgcolor_1 mb10">
                                    <div class="summary_target_title"><a title="点击">点击</a></div>
                                    <div class="summary_target_body summary_target_color_1">{$keyindex_data[1].click} <span class="summary_target_body_unit">次</span></div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 col-sx-12" ng-repeat="(index,item) in table_items">
                                <div class="summary_target summary_target_2 summary_target_bgcolor_2 mb10">
                                    <div class="summary_target_title"><a title="消费">消费</a></div>
                                    <div class="summary_target_body summary_target_color_2">{$keyindex_data[1].cost}  <span class="summary_target_body_unit">元</span></div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 col-sx-12" ng-repeat="(index,item) in table_items">
                                <div class="summary_target summary_target_3 summary_target_bgcolor_3 mb10">
                                    <div class="summary_target_title"><a title="展现">展现</a></div>
                                    <div class="summary_target_body summary_target_color_3">{$keyindex_data[1].impression}  <span class="summary_target_body_unit">次</span></div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 col-sx-12" ng-repeat="(index,item) in table_items">
                                <div class="summary_target summary_target_4 summary_target_bgcolor_4 mb10">
                                    <div class="summary_target_title"><a title="点击价格">点击价格</a></div>
                                    <div class="summary_target_body summary_target_color_4">{$keyindex_data[1].cpc}  <span class="summary_target_body_unit">元 /点击</span></div>
                                </div>
                            </div>
                            <div class="col-lg-2 col-md-4 col-sm-6 col-sx-12" ng-repeat="(index,item) in table_items">
                                <div class="summary_target summary_target_5 summary_target_bgcolor_5 mb10">
                                    <div class="summary_target_title"><a title="点击率">点击率</a></div>
                                    <div class="summary_target_body summary_target_color_5">{$keyindex_data[1].ctr}  <span class="summary_target_body_unit"></span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="qi_con_1">
            <p class="qi_p_4">关键指标变化率</p>
            <div class="qi_bfb_100">
                <select class="qi_float_r" id="keyindex_select">
                    <option value="ccc">消费/点击/CPC</option>
                    <option value="rcc">平均排名/CPC/CTR</option>
                    <option value="icr">展现/CTR/平均排名</option>
                </select>
            </div>
            <!--统计图1  关键指标变化率 
                *******************
                -->
            <div id="myChart1" style="width: 600px;height: 400px;"></div>
            <!--统计图1 end-->
        </div>
        <div class="qi_con_1">
            <p class="qi_p_4">趋势图</p>
            <div class="qi_bfb_100">
                <select class="qi_float_r" id="qushitu_select">
                    <option value="trend_impression">展现</option>
                    <option value="trend_cost">消费</option>
                    <option value="trend_click">点击</option>
                    <option value="trend_cpc">CPC</option>
                    <option value="trend_ctr">CTR</option>
                    <option value="trend_cpm">CPM</option>
                    <option value="trend_avgrank">平均排名</option>
                </select>
            </div>
            <!--统计图2 趋势图-->
            <div id="myChart2" style="width: 600px;height:400px;"></div>
            <div hidden="true">
                <p id="trend_data">{$trend_data}</p>
            </div>
            <!--统计图2 趋势图 end-->
        </div>
        <div class="qi_con_1">
            <p class="qi_p_4">地域情况</p>
            <div class="qi_bfb_100">
                <select class="qi_float_r" id="diyu_select">
                    <option value="0">展现</option>
                    <option value="1">消费</option>
                    <option value="2">点击</option>
                    <option value="3">CPC</option>
                    <option value="4">CTR</option>
                    <option value="5">平均排名</option>
                </select>
            </div>
            <!-- 地区分布  -->
            <div id="china-map" style="width: 600px;height:400px;"></div>
            
        </div>
        <!-- 地域分布  end -->
        <div class="qi_con_1">
            <p class="qi_p_4">分时汇总</p>
            <div class="qi_bfb_100">
                <select class="qi_float_r" id="fenshi_select">
                    <option value="fenshi_cost">消费</option>
                    <option value="fenshi_impression">展现</option>
                    <option value="fenshi_click">点击</option>
                    <option value="fenshi_cpc">CPC</option>
                    <option value="fenshi_ctr">CTR</option>
                    <option value="fenshi_avgrank">平均排名</option>
                </select>
            </div>
            <!-- 分时汇总 -->
            <div id="myChart4" style="width: 600px;height:400px;"></div>
            <div hidden="true">
                <p id="fenshi_data">{$fenshi_data}</p>
            </div>
            <!-- 分时汇总 end -->
        </div>
    </div>
<!-- 关键指标变化率 myChart1****************************-->
    <script type="text/javascript">

    // 基于准备好的dom，初始化echarts实例
    var myChart1 = echarts.init(document.getElementById('myChart1'));
    // 指定图表的配置项和数据
    var option1 = {
        tooltip: {
            formatter: "{a} <br/>{b} : {c}%"
        },
        toolbox: {
            feature: {
                saveAsImage: {
                    pixelRatio: 3
                }
            }
        },
        series: [{
                name: '业务指标',
                type: 'gauge',
                radius: '50%',
                center: ['20%', '55%'],
                min: 0,
                max: 200,
                splitNumber: 4,
                axisLine: { // 坐标轴线
                    lineStyle: { // 属性lineStyle控制线条样式
                        width: 5
                    }
                },
                detail: {
                    formatter: '{value}%',
                    fontSize: 15
                },
                data: [{
                    value: 0,
                    name: '消费'
                }]
            },

            {
                name: '业务指标',
                type: 'gauge',
                radius: '50%',
                center: ['50%', '55%'],
                min: 0,
                max: 200,
                splitNumber: 4,
                axisLine: { // 坐标轴线
                    lineStyle: { // 属性lineStyle控制线条样式
                        width: 5
                    }
                },

                detail: {
                    formatter: '{value}%',
                    fontSize: 15
                },
                data: [{
                    value: 0,
                    name: '点击'
                }]
            }, {
                name: '业务指标',
                type: 'gauge',
                radius: '50%',
                center: ['80%', '55%'],
                min: 0,
                max: 200,
                splitNumber: 4,
                axisLine: { // 坐标轴线
                    lineStyle: { // 属性lineStyle控制线条样式
                        width: 5
                    }
                },
                detail: {
                    formatter: '{value}%',
                    fontSize: 15
                },
                data: [{
                    value: 0,
                    name: 'CPC'
                }]
            },
        ]
    };

    var ki_a0 = {$keyindex_data[0].cost};
    var ki_a1 = {$keyindex_data[1].cost};
    ki_b0 = {$keyindex_data[0].click};
    ki_b1 = {$keyindex_data[1].click};
    ki_c0 = {$keyindex_data[0].cpc};
    ki_c1 = {$keyindex_data[1].cpc};
    
    setInterval(function() {
        option1.series[0].data[0].value =Math.round(ki_a1 /ki_a0*10000.0)/100 ;
        option1.series[1].data[0].value = Math.round(ki_b1 /ki_b0*10000.0)/100;
        option1.series[2].data[0].value = Math.round(ki_c1 /ki_c0*10000.0)/100;
        myChart1.setOption(option1, true);
    }, 2000);

    // 使用刚指定的配置项和数据显示图表。
    myChart1.setOption(option1);
    $("#keyindex_select").change(function(event) {
        /* Act on the event */
        if ($(this).val()=="ccc") {
            option1.series[0].data[0].name = "消费";
            option1.series[1].data[0].name = "点击";
            option1.series[2].data[0].name = "cpc";
            ki_a0 = {$keyindex_data[0].cost};
            ki_a1 = {$keyindex_data[1].cost};
            ki_b0 = {$keyindex_data[0].click};
            ki_b1 = {$keyindex_data[1].click};
            ki_c0 = {$keyindex_data[0].cpc};
            ki_c1 = {$keyindex_data[1].cpc}; 
            myChart1.setOption(option1);
        }else if ($(this).val()=="rcc") {
            option1.series[0].data[0].name = "平均排名";
            option1.series[1].data[0].name = "cpc";
            option1.series[2].data[0].name = "ctr";
            ki_a0 = 1;
            ki_a1 = 0;
            ki_b0 = {$keyindex_data[0].cpc};
            ki_b1 = {$keyindex_data[1].cpc};
            ki_c0 = {$keyindex_data[0].ctr};
            ki_c1 = {$keyindex_data[1].ctr};
            myChart1.setOption(option1);
        }else if ($(this).val()=="icr") {
            option1.series[0].data[0].name = "展现";
            option1.series[1].data[0].name = "ctr";
            option1.series[2].data[0].name = "平均排名";
            ki_a0 = {$keyindex_data[0].impression};
            ki_a1 = {$keyindex_data[1].impression};
            ki_b0 = {$keyindex_data[0].ctr};
            ki_b1 = {$keyindex_data[1].ctr};
            ki_c0 = 1;
            ki_c1 = 0;
            myChart1.setOption(option1);
        }
    });



    </script>
<!-- 趋势图 myChart2**************************** -->
    <script>
    var myChart2 = echarts.init(document.getElementById('myChart2'));
    var option2 = {
        tooltip: {
            formatter: "{a} <br/>{b} : {c}"
        },
        toolbox: {
            feature: {
                saveAsImage: {
                    pixelRatio: 3
                }
            }
        },
        xAxis: {
            type: 'category',
            data:$.parseJSON($("#trend_data").text())['date']
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            name:$.parseJSON($("#trend_data").text())['name'],
            data: $.parseJSON($("#trend_data").text())['impression'],
            type: 'line',
            smooth: true
        }]
    };
    
    myChart2.setOption(option2);
    $("#qushitu_select").change(function(event) {
        /* Act on the event */
        switch($(this).val()){
            case "trend_impression":
                option2.series[0].data=$.parseJSON($("#trend_data").text())['impression'];
                myChart2.setOption(option2);
                break;
            case "trend_cost":
                option2.series[0].data=$.parseJSON($("#trend_data").text())['cost'];
                myChart2.setOption(option2);
                break;
            case "trend_cpc":
                option2.series[0].data=$.parseJSON($("#trend_data").text())['cpc'];
                myChart2.setOption(option2);
                break;
            case "trend_ctr":
                option2.series[0].data=$.parseJSON($("#trend_data").text())['ctr'];
                myChart2.setOption(option2);
                break;
            case "trend_click":
                option2.series[0].data=$.parseJSON($("#trend_data").text())['click'];
                myChart2.setOption(option2);
                break;
            case "trend_cpm":
                option2.series[0].data=$.parseJSON($("#trend_data").text())['cpm'];
                myChart2.setOption(option2);
                break;
            case "trend_avgrank":
                option2.series[0].data=$.parseJSON($("#trend_data").text())['avgrank'];
                myChart2.setOption(option2);
                break;
            default :break;
        }
        
    });
    </script>
<!-- 地域分布 myChart3****************************-->
    <script>
    var myChart3 = echarts.init(document.getElementById('china-map'));
    var option3 = {
        title: [{
            color: '#033',
            text: "ditu ",
            textStyle: {
                fontWeight: 'bold',
            }
        }],
        toolbox: {
            show: true,
            orient: 'vertical',
            left: 'right',
            top: 'center',
            feature: {
                dataView: {
                    readOnly: false
                },
                restore: {},
                saveAsImage: {
                    pixelRatio: 4,
                    backgroundColor: '#fff'

                }
            }
        },
        legend: [{
            type: 'plain',
            left: 'auto',
            top: 'auto',
            orient: 'vertical',
            formatter: "ddddddd",
            tooltip: {
                show: true
            },
            data: [{
                name: '系列1',
                // 强制设置图形为圆。
                icon: 'circle',
                // 设置文本为红色
                textStyle: {
                    color: 'red'
                }
            }],
            icon: 'rect'
        }],
        tooltip: {
            // show: false, //不显示提示标签
            formatter: '{b}',
            /*提示标签格式*/
            backgroundColor: "#ff7f50", //提示标签背景颜色
            textStyle: {
                color: "#fff"
            } //提示标签字体颜色
        },
        series: [{
            type: 'map',
            mapType: 'china',
            label: {
                normal: {
                    show: true, //显示省份标签
                    textStyle: {
                        color: "#c71585"
                    } //省份标签字体颜色
                },
                emphasis: {
                    //对应的鼠标悬浮效果
                    show: true,
                    textStyle: {
                        color: "#800080"
                    }
                }
            },
            toolbox: {
                show: true,
                feature: {
                    dataView: {
                        readOnly: false
                    },
                    restore: {},
                    saveAsImage: {
                        pixelRatio: 4
                    }
                }
            },
            itemStyle: {
                normal: {
                    borderWidth: .5, //区域边框宽度
                    borderColor: '#009fe8', //区域边框颜色
                    areaColor: "#ffefd5", //区域颜色
                },
                emphasis: {
                    borderWidth: .5,
                    borderColor: '#4b0082',
                    areaColor: "#ffdead",
                }
            },
            data: [{
                    name: '福建',
                    selected: true
                } //福建为选中状态
            ]
        }],
    };

    myChart3.setOption(option3);
    myChart3.on('mouseover', function(params) {
        var dataIndex = params.dataIndex;
        /*console.log(params);*/
    });
    myChart3.dispatch({
        type: 'showTip',
        x: 10,
        y: 10
    })
    var img = new Image();
    img.src = myChart1.getDataURL();
    console.log(img.src);
    document.getElementById("button_download").onclick = function() {
        document.getElementById("download_img").href = img.src;
    }
    </script>
<!-- 分时汇总 myChart4*********************** -->
    <script>
    var myChart4 = echarts.init(document.getElementById('myChart4'));
    var option4 = {
        tooltip: {
            formatter: "{a} <br/>{b}时 : {c}"
        },
        toolbox: {
            feature: {
                saveAsImage: {
                    pixelRatio: 3
                }
            }
        },
         yAxis: {
            type: 'value'
        },
        xAxis: {
            type: 'category',
            data: jQuery.parseJSON($("#fenshi_data").text())['date'],
        },
       
        series: [{
            data: jQuery.parseJSON($("#fenshi_data").text())['kpis']['cost'],
            type: 'bar'
        }]
    };
   
    myChart4.setOption(option4);
   $("#fenshi_select").change(function(event) {
       switch($(this).val()){
        case "fenshi_impression":
            option4.xAxis.data = jQuery.parseJSON($("#fenshi_data").text())['date'];
            option4.series[0].data =jQuery.parseJSON($("#fenshi_data").text())['kpis']['impression']; 
            myChart4.setOption(option4);
            break;
        case "fenshi_cost":
            option4.xAxis.data = jQuery.parseJSON($("#fenshi_data").text())['date'];
            option4.series[0].data =jQuery.parseJSON($("#fenshi_data").text())['kpis']['cost']; 
            myChart4.setOption(option4);
            break;
        case "fenshi_click":
            option4.xAxis.data = jQuery.parseJSON($("#fenshi_data").text())['date'];
            option4.series[0].data =jQuery.parseJSON($("#fenshi_data").text())['kpis']['click']; 
            myChart4.setOption(option4);
            break;
        case "fenshi_avgrank":
            option4.xAxis.data = jQuery.parseJSON($("#fenshi_data").text())['date'];
            option4.series[0].data =jQuery.parseJSON($("#fenshi_data").text())['kpis']['avgrank']; 
            myChart4.setOption(option4);
            break;
        case "fenshi_cpc":
            option4.xAxis.data = jQuery.parseJSON($("#fenshi_data").text())['date'];
            option4.series[0].data =jQuery.parseJSON($("#fenshi_data").text())['kpis']['cpc']; 
            myChart4.setOption(option4);
            break;
        case "fenshi_ctr":
            option4.xAxis.data = jQuery.parseJSON($("#fenshi_data").text())['date'];
            option4.series[0].data =jQuery.parseJSON($("#fenshi_data").text())['kpis']['ctr']; 
            myChart4.setOption(option4);
            break;
        default :
            break;
       }
   });
    </script>
</body>

</html>
<script>
$(".bai_name").click(function() {
    var target = $(this).text();
    $("#zhanghu").html(target);
    $("#firstpane").css('display', 'none');
    $("#zhanghu").css('color', 'red');

    $.ajax({
        type: "post",
        url: "__CONTROLLER__/index",
        data: {
            target: target
        },
        dataType: "json",
        success: function(data) {
            alert(1111111);
            // window.location = "/Admin/Index/index";
        }
    });
})
$(function(){

    var word = $("#device_current").text();
    var option = $("#device option");
    for(var i=0;i<option.length;i++){
        if(word == option[i].value){
            option[i].selected = 'selected';
            break;
        }
    }
});
$("#device").change(function() {
    
    var device = $(this).val();
    console.log(device);
    window.location.href="__CONTROLLER__/index?device="+device;

    /*$.ajax({
        type: "post",
        url: "__CONTROLLER__/index",
        data: {
            device: device
        },
        dataType: "json",
        success: function(data) {
            alert(1111111);
            // window.location = "/Admin/Index/index";
        }
    });*/
})
</script>
