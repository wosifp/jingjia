<admintpl file="header" />
<style>
.home_info li em {
	float: left;
	width: 120px;
	font-style: normal;
}
li {
	list-style: none;
}

</style>

<link href="__PUBLIC__/admin/css/bootstrap.min.css" rel="stylesheet">
<link href="__PUBLIC__/admin/css/style.css" rel="stylesheet" type="text/css"/>
<script src="__PUBLIC__/admin/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__PUBLIC__/admin/js/jquery.min.js"></script>
<script src="__PUBLIC__/admin/js/style.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/datePicker/laydate/laydate.js"></script>
<!--<link type="text/css" rel="stylesheet" href="__PUBLIC__/admin/css/laydate.css">
<link type="text/css" rel="stylesheet" href="__PUBLIC__/admin/css/laydate(1).css" id="LayDateSkin"> -->

<script src="__PUBLIC__/js/echarts/echarts.min.js"></script>


</head>
<body>
	<div class="qi_right_1">
		<div class="qi_con_1">
			<div class="qi_float_l qi_bfb_30">
				<p class="qi_p_2">
					账户：<a class="btn btn-default" href="javascript:" role="button">选择 <span class="caret"></span></a>
				</p>
				<div id="firstpane" class="menu_list" style="display:none">
					<hr>
					<p class="qi_p_3">
						<span>可获取对象</span>
						<input type="text">
						<a href="javascript:" class="qi_a_1">搜索</a>
						<!--<input id="r2" type="radio" value="1" name="">精确 </input>-->
					</p>
					<foreach name="trade" item="vo" key="k">
						<h3 class="menu_head">{$k}</h3>
						<div style="display: none;" class="menu_body">
							<foreach name="vo" item="companyname" key="kk">
								<a href="javascript:" >{$kk}</a>
								<div style="display: none;" class="menu_body">
									<foreach name="companyname" item="user_login" key="kkk">
										<a href="javascript:"><span class="bai_name">{$user_login.user_login}</span></a>
									</foreach>
								</div>
							</foreach>
						</div>
					</foreach>
				</div>
			</div>
            <div class="qi_float_l qi_bfb_30" id="zhanghu" style="color: red">
            </div>

			<!--设备-->
			<div class="qi_float_l qi_bfb_30">
				设备：<select id="device">
				<option value="0">全部</option>
				<option value="2">PC</option>
				<option value="1">移动</option>
			</select>
			</div>
			<!--设备 end-->


			<!--时间-->
			<div class="qi_float_l qi_bfb_30">
				时间：<input type="text" name="date_pick" id="datepicker1">
				<script>
                    laydate.render({
                      elem: '#datepicker1' ,
                      range: true,//指定元素
                      done: function(value){
                            $.ajax({
                                type: "post",
                                url: "/Admin/Main/index",
                                data: {
                                    datepicker:value
                                },
                                dataType: "json",
                                success: function(data){
                                    alert(1111111);
                                }
                            });
                      }
                    });
				</script>
			</div>
			<!--时间 end-->
		</div>
		<!--新增 基本关键指标 start-->
		<div class="qi_con_1">
			<div class="qi_bfb_100">
				<p>关键指标</p>
			</div>
			<div class="qi_d_0">
				<div calss="qi_d_1"style='float:left;width: 250px;height: 100px;'>
					<p>点击</p><input>次
				</div>
				<div calss="qi_d_1" style='float:left;width: 250px;height: 100px; '>
					<p>消费</p><input>元
				</div>
				<div calss="qi_d_1" style='float:left; width: 250px;height: 100px;'>
					<p>UV</p><input>个
				</div>
				<div calss="qi_d_1" style='float:left;width: 250px;height: 100px;'>
					<p>转换次数</p><input>次
				</div>
				<div calss="qi_d_1" style='float:left; width: 250px;height: 100px;'>
					<p>CPA</p><input>元
				</div>
			</div>

		</div>
		<!--新增 基本关键指标 end-->

		<div class="qi_con_1">
			<p class="qi_p_4">关键指标变化率</p>
			<div class="qi_bfb_100">
				<select class="qi_float_r">
					<option value="volvo">消费/点击/CPC</option>
					<option value="saab">平均排名/CPC/CTR</option>
					<option value="opel">展现/CTR/平均排名</option>
				</select>
			</div>
			<!--统计图2-->
			<!--<div id="chart2" height="400" width="600"></div>-->
            <div id="main" style="width: 600px;height:400px;"></div>
            <script type="text/javascript">
                // 基于准备好的dom，初始化echarts实例
                var myChart = echarts.init(document.getElementById('main'));
//                var myChart = echarts.init($("#main"));
                //console.log(myChart);

                // 指定图表的配置项和数据
                var option = {
                    tooltip : {
                        formatter: "{a} <br/>{b} : {c}%"
                    },
                    toolbox: {
                        feature: {
                            restore: {},
                            saveAsImage: {}
                        }
                    },
                    series: [
                        {
                            name: '业务指标',
                            type: 'gauge',
                            radius: '50%',
                            center: ['20%', '55%'],
                            min: 0,
                            max: 200,
                            splitNumber: 4,
                            axisLine: {            // 坐标轴线
                                lineStyle: {       // 属性lineStyle控制线条样式
                                    width: 5
                                }
                            },
                            detail: {
                                formatter:'{value}%',
                                fontSize:15
                            },
                            data: [{value: 50, name: '点击'}]
                        },

                        {
                            name: '业务指标',
                            type: 'gauge',
                            radius: '50%',
                            center: ['50%', '55%'],
                            min: 0,
                            max: 200,
                            splitNumber: 4,
                            axisLine: {            // 坐标轴线
                                lineStyle: {       // 属性lineStyle控制线条样式
                                    width: 5
                                }
                            },

                            detail: {
                                formatter:'{value}%',
                                fontSize:15
                            },
                            data: [{value: 50, name: '转化次数'}]
                        },
                        {
                            name: '业务指标',
                            type: 'gauge',
                            radius: '50%',
                            center: ['80%', '55%'],
                            min: 0,
                            max: 200,
                            splitNumber: 4,
                            axisLine: {            // 坐标轴线
                                lineStyle: {       // 属性lineStyle控制线条样式
                                    width: 5
                                }
                            },
                            detail: {
                                formatter:'{value}%',
                                fontSize:15
                            },
                            data: [{value: 50, name: 'CPA'}]
                        },
                    ]
                };

                setInterval(function () {
                    option.series[0].data[0].value = (Math.random() * 100).toFixed(2) - 0;
                    option.series[1].data[0].value = (Math.random() * 50).toFixed(2) - 0;
                    option.series[2].data[0].value = (Math.random() * 50).toFixed(2) - 0;
                    myChart.setOption(option, true);
                },2000);

                // 使用刚指定的配置项和数据显示图表。
                //myChart.setOption(option);
            </script>
			<!--统计图2 end-->

			<a href="javascript:" class="qi_a_1 qi_float_r">下载</a>
		</div>

        <div class="qi_con_1">
            <p class="qi_p_4">趋势图</p>
            <div class="qi_bfb_100">
                <select class="qi_float_r" id="qushitu_select">
                    <option value="0">展现</option>
                    <option value="1">消费</option>
                    <option value="2">点击</option>
                    <option value="3">CPC</option>
                    <option value="4">CTR</option>
                    <option value="5">平均排名</option>
                </select>
            </div>


            <!--统计图1-->
            <div id="div_json" hidden="true">
                <p id='p1'> {$json_data}</p>
                <p id="p2">{$lebal}</p>
                <p id="p3">{$result}</p>
            </div>
            <div height="400" width="600">
                <canvas id="myChart0"> 你的浏览器不支持HTML5 canvas </canvas>
            </div>
            <!--统计图1 end-->
            <a href="javascript:" id='downloadimg'  download="chartimg">
                <button id="download" class="qi_a_1 qi_float_r">下载</button></a>
                <script>

                    var ctxtemp = document.getElementById("myChart0");
                    var ctx = ctxtemp.getContext('2d');
                    $lebal_temp = $.parseJSON($('#div_json #p2').text());
                    $data_temp = $.parseJSON($('#div_json #p3').text());
                    $data_selected=$data_temp[3];
                    var config = {
                        type: 'line',
                        data: {
                            labels: $lebal_temp,
                            datasets: [{
                                <!-- label: '# of Votes', -->
                                label:"展现",
                                data: $data_selected,
                                backgroundColor: [
                                    'rgba(255, 99, 132, 0)',
                                    'rgba(54, 162, 235, 0.9)',
                                    'rgba(255, 206, 86, 0.2)',
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(153, 102, 255, 0.2)',
                                    'rgba(255, 159, 64, 0.2)'
                                ],
                                borderColor: [
                                    <!-- 'rgba(255,99,132,1)', -->
                                    'rgba(54, 162, 235, 1)',
                                    'rgba(255, 206, 86, 1)',
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(153, 102, 255, 1)',
                                    'rgba(255, 159, 64, 1)'
                                ],

                                borderWidth: 3
                            }],
                        },
                        options: {
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero:true
                                    }
                                }]
                            }

                        }
                    };
                    var myChart = new Chart(ctx,config );
                    $('.qi_bfb_100 .qi_float_r').change(function() {

                        $data_selected = $data_temp[$(this).val()];
                        $lebal_selected = $('#qushitu_select :selected').text();
                        console.log($lebal_selected);
                        config.data.datasets.forEach(function(item){
                            item.data=$data_selected;
                            item.label=$lebal_selected;
                        })
                        myChart.update();
                    });



                    /*<!-- console.dir($('#chart0')) -->*/
                    // Converts canvas to an image
                    document.getElementById("download").onclick=function(){
                        convertCanvasToImage(ctxtemp);
                    }
                    function convertCanvasToImage(canvas) {
                        var image = new Image();
                        image.src = canvas.toDataURL("image/png");
                        /*console.log(image.src);*/
                        /*<!-- document.getElementById("img").innerHTML=''; -->*/
                        document.getElementById("downloadimg").href=image.src;
                        // document.getElementById("img").src=image.src;

                        return image;
                    }
                </script>

        </div>

		<div class="qi_con_1">
			<p class="qi_p_4">分时汇总</p>
			<div class="qi_bfb_100">
				<select class="qi_float_r">
					<option value="volvo">消费</option>
					<option value="saab">展现</option>
					<option value="opel">点击</option>
					<option value="audi">CPC</option>
					<option value="audi">CTR</option>
					<option value="audi">平均排名</option>
				</select>
			</div>
			<div height="300" width="900">
				<canvas id="barChart"> 你的浏览器不支持HTML5 canvas </canvas>
			</div>
			<script type="text/javascript">
                function goBarChart(dataArr){
                    // 声明所需变量
                    var canvas,ctx;
                    // 图表属性
                    var cWidth, cHeight, cMargin, cSpace;
                    var originX, originY;
                    // 柱状图属性
                    var bMargin, tobalBars, bWidth, maxValue;
                    var totalYNomber;
                    var gradient;

                    // 运动相关变量
                    var ctr, numctr, speed;
                    //鼠标移动
                    var mousePosition = {};

                    // 获得canvas上下文
                    canvas = document.getElementById("barChart");
                    if(canvas && canvas.getContext){
                        ctx = canvas.getContext("2d");
                    }
                    initChart(); // 图表初始化
                    drawLineLabelMarkers(); // 绘制图表轴、标签和标记
                    drawBarAnimate(); // 绘制柱状图的动画
                    //检测鼠标移动
                    var mouseTimer = null;
                    canvas.addEventListener("mousemove",function(e){
                        e = e || window.event;
                        if( e.offsetX || e.offsetX==0 ){
                            mousePosition.x = e.offsetX;
                            mousePosition.y = e.offsetY;
                        }else if( e.layerX || e.layerX==0 ){
                            mousePosition.x = e.layerX;
                            mousePosition.y = e.layerY;
                        }

                        clearTimeout(mouseTimer);
                        mouseTimer = setTimeout(function(){
                            ctx.clearRect(0,0,canvas.width, canvas.height);
                            drawLineLabelMarkers();
                            drawBarAnimate(true);
                        },10);
                    });

                    //点击刷新图表
                    canvas.onclick = function(){
                        initChart(); // 图表初始化
                        drawLineLabelMarkers(); // 绘制图表轴、标签和标记
                        drawBarAnimate(); // 绘制折线图的动画
                    };


                    // 图表初始化
                    function initChart(){
                        // 图表信息
                        cMargin = 60;
                        cSpace = 80;
                        /*这里是对高清屏幕的处理，
                             方法：先将canvas的width 和height设置成本来的两倍
                             然后将style.height 和 style.width设置成本来的宽高
                             这样相当于把两倍的东西缩放到原来的 1/2，这样在高清屏幕上 一个像素的位置就可以有两个像素的值
                             这样需要注意的是所有的宽高间距，文字大小等都得设置成原来的两倍才可以。
                        */
                        canvas.width = canvas.parentNode.getAttribute("width")* 2 ;
                        canvas.height = canvas.parentNode.getAttribute("height")* 2;
                        canvas.style.height = canvas.height/2 + "px";
                        canvas.style.width = canvas.width/2 + "px";
                        cHeight = canvas.height - cMargin - cSpace;
                        cWidth = canvas.width - cMargin - cSpace;
                        originX = cMargin + cSpace;
                        originY = cMargin + cHeight;

                        // 柱状图信息
                        bMargin = canvas.width/40;
                        tobalBars = dataArr.length;
                        bWidth = parseInt( cWidth/tobalBars - bMargin );
                        maxValue = 0;
                        for(var i=0; i<dataArr.length; i++){
                            var barVal = parseInt( dataArr[i][1] );
                            if( barVal > maxValue ){
                                maxValue = barVal;
                            }
                        }
                        maxValue += 50;
                        totalYNomber = 10;
                        // 运动相关
                        ctr = 1;
                        numctr = 100;
                        speed = 10;

                        //柱状图渐变色
                        gradient = ctx.createLinearGradient(0, 0, 0, 300);
                        gradient.addColorStop(0, 'green');
                        gradient.addColorStop(1, 'rgba(67,203,36,1)');

                    }

                    // 绘制图表轴、标签和标记
                    function drawLineLabelMarkers(){
                        //ctx.translate(0.5,0.5);  // 当只绘制1像素的线的时候，坐标点需要偏移，这样才能画出1像素实线
                        ctx.font = "24px Arial";
                        ctx.lineWidth = 2;
                        ctx.fillStyle = "#000";
                        ctx.strokeStyle = "#000";
                        // y轴
                        drawLine(originX, originY, originX, cMargin);
                        // x轴
                        drawLine(originX, originY, originX+cWidth, originY);

                        // 绘制标记
                        drawMarkers();
                        //ctx.translate(-0.5,-0.5);  // 还原位置
                    }

                    // 画线的方法
                    function drawLine(x, y, X, Y){
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                        ctx.lineTo(X, Y);
                        ctx.stroke();
                        ctx.closePath();
                    }

                    // 绘制标记
                    function drawMarkers(){
                        ctx.strokeStyle = "#E0E0E0";
                        // 绘制 y
                        var oneVal = parseInt(maxValue/totalYNomber);
                        ctx.textAlign = "right";
                        for(var i=0; i<=totalYNomber; i++){
                            var markerVal =  i*oneVal;
                            var xMarker = originX-10;
                            var yMarker = parseInt( cHeight*(1-markerVal/maxValue) ) + cMargin;

                            ctx.fillText(markerVal, xMarker, yMarker+3, cSpace); // 文字
                            if(i>0){
                                drawLine(originX+2, yMarker, originX+cWidth, yMarker);
                            }
                        }
                        // 绘制 x
                        ctx.textAlign = "center";
                        for(var i=0; i<tobalBars; i++){
                            var markerVal = dataArr[i][0];
                            var xMarker = parseInt( originX+cWidth*(i/tobalBars)+bMargin+bWidth/2 );
                            var yMarker = originY+30;
                            ctx.fillText(markerVal, xMarker, yMarker, cSpace); // 文字
                        }
                        // 绘制标题 y
                        ctx.save();
                        ctx.rotate(-Math.PI/2);
                        ctx.fillText("点 击", -canvas.height/2, cSpace-10);
                        ctx.restore();
                        // 绘制标题 x
                        ctx.fillText("时", originX+cWidth/2, originY+cSpace/2+30);
                    };

                    //绘制柱形图
                    function drawBarAnimate(mouseMove){
                        for(var i=0; i<tobalBars; i++){
                            var oneVal = parseInt(maxValue/totalYNomber);
                            var barVal = dataArr[i][1];
                            var barH = parseInt( cHeight*barVal/maxValue * ctr/numctr );
                            var y = originY - barH;
                            var x = originX + (bWidth+bMargin)*i + bMargin;
                            drawRect( x, y, bWidth, barH-1, mouseMove );  //高度减一避免盖住x轴
                            ctx.fillText(parseInt(barVal*ctr/numctr), x+30, y-8); // 文字
                        }
                        if(ctr<numctr){
                            ctr++;
                            setTimeout(function(){
                                ctx.clearRect(0,0,canvas.width, canvas.height);
                                drawLineLabelMarkers();
                                drawBarAnimate();
                            }, speed);
                        }
                    }

                    //绘制方块
                    function drawRect( x, y, X, Y, mouseMove ){

                        ctx.beginPath();
                        ctx.rect( x, y, X, Y );

                        if(mouseMove && ctx.isPointInPath(mousePosition.x*2, mousePosition.y*2)){ //如果是鼠标移动的到柱状图上，重新绘制图表
                            ctx.fillStyle = "green";

                        }else{
                            ctx.fillStyle = gradient;
                            ctx.strokeStyle = gradient;
                        }
                        ctx.fill();
                        ctx.closePath();

                    }


                }


                goBarChart(
                    [[0, 750], [1, 425], [2, 960], [3, 700], [4, 800], [5, 975], [6, 375], [7, 775], [8, 675], [9, 675], [10, 425], [11, 425], [12, 960], [13, 700], [14, 800], [15, 975], [16, 375], [17, 775], [18, 675], [19, 670], [20, 750], [21, 700], [22, 675], [23, 666]]
                )


			</script>
			<a href="javascript:" class="qi_a_1 qi_float_r">下载</a>

		</div>
	</div>


</body>
</html>


<script>
    $(".bai_name").click(function () {
        var target = $(this).text();
        $("#zhanghu").append(target);
        $("#firstpane").css('display','none');
        $("#zhanghu").css('color','red');

        $.ajax({
            type: "post",
            url: "/Admin/Main/index",
            data: {
                target:target
            },
            dataType: "json",
            success: function(data){
                 alert(1111111);
               // window.location = "/Admin/Index/index";
            }
        });
    })
    $("#device").change(function () {
        var device = $('#device :selected').val();
        $.ajax({
            type: "post",
            url: "/Admin/Main/index",
            data: {
                device:device
            },
            dataType: "json",
            success: function(data){
                 alert(1111111);
               // window.location = "/Admin/Index/index";
            }
        });
    })
</script>

